<!doctype html>
<html lang="en" class="h-full" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">MY FINANCIALS — USD · <span id="titleCurrency">EGP</span></title>
  <link rel="icon" type="image/svg+xml" href="Images/Favicon.svg">
  <link rel="alternate icon" href="Images/Favicon.svg">
  <link rel="apple-touch-icon" href="Images/Favicon.svg">
  <!-- Note: Using CDN Tailwind for development. For production, install as PostCSS plugin -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
  
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Sync System (load before main script) -->
  <script src="sync/sync-loader.js"></script>
  
  <!-- Chart.js for Analytics Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  
  <script src="script.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="h-full">

  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen">
    <div class="splash-content">
      <div class="splash-logo-container">
        <img src="Images/Logo.svg" class="splash-logo" alt="Financial Tool">
        <div class="splash-logo-glow"></div>
      </div>
      <div class="splash-progress-container">
        <div class="splash-progress-bar">
          <div class="splash-progress-fill"></div>
        </div>
        <div class="splash-progress-text">Loading your financial data...</div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto p-4 md:p-6 lg:p-10 space-y-6" id="mainContent">
    <!-- Header -->
    <header class="flex flex-wrap items-center gap-3 justify-between">
      <div class="flex items-center gap-3">
        <div class="logo-container">
          <img src="Images/Logo.svg" class="h-8 w-auto">
        </div>
      </div>
      
      <!-- Navigation Tabs in Header -->
      <div class="flex items-center gap-2">
        <button id="tabAnalytics" class="nav-btn nav-btn-analytics active" data-page="analytics">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
            <path d="M3 3v18h18"/>
            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
          </svg>
          Analytics
        </button>
        <button id="tabExpenses" class="nav-btn nav-btn-expenses" data-page="expenses">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
            <path d="M12 19V5M5 12l7-7 7 7"/>
          </svg>
          Expenses
        </button>
        <button id="tabIncome" class="nav-btn nav-btn-income" data-page="income">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
            <path d="M12 5v14M19 12l-7 7-7-7"/>
          </svg>
          Income
        </button>
        
      </div>
      
      <div class="flex items-center gap-2 relative">
        <button id="btnRefresh" class="icon-btn size-8 rounded-xl border hover:bg-white/5 transition sync-button" title="Refresh from Cloud" style="border-color:var(--stroke)">
          <svg id="iconRefresh" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-3 h-3">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            <path d="M3 21v-5h5"/>
          </svg>
          <span id="syncStatus" class="sync-status"></span>
        </button>
        
        <!-- Currency Selector -->
        <div class="relative">
          <button id="btnCurrency" class="icon-btn size-8 rounded-xl border hover:bg-white/5 transition" title="Select Currency" style="border-color:var(--stroke); min-width: 60px; padding: 0 8px;">
            <span id="currencySymbol" class="text-xs font-semibold">EGP</span>
          </button>
          
          <!-- Currency Dropdown Menu -->
          <div id="currencyDropdown" class="absolute right-0 top-full mt-2 w-48 rounded-lg shadow-lg z-50" style="display: none; background:var(--bg); border: 1px solid var(--stroke);">
            <div class="p-2">
              <div class="text-xs font-medium mb-2 px-2" style="color:var(--muted)">Select Currency</div>
              <div class="space-y-1">
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="EGP" data-symbol="EGP" data-rate="48.1843">
                  <span class="text-xs font-semibold">EGP</span>
                  <span class="text-xs" style="color:var(--muted)">Egyptian Pound</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="KWD" data-symbol="KWD" data-rate="0.31">
                  <span class="text-xs font-semibold">KWD</span>
                  <span class="text-xs" style="color:var(--muted)">Kuwaiti Dinar</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="SAR" data-symbol="SAR" data-rate="3.75">
                  <span class="text-xs font-semibold">SAR</span>
                  <span class="text-xs" style="color:var(--muted)">Saudi Riyal</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="AED" data-symbol="AED" data-rate="3.67">
                  <span class="text-xs font-semibold">AED</span>
                  <span class="text-xs" style="color:var(--muted)">UAE Dirham</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="QAR" data-symbol="QAR" data-rate="3.64">
                  <span class="text-xs font-semibold">QAR</span>
                  <span class="text-xs" style="color:var(--muted)">Qatari Riyal</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="BHD" data-symbol="BHD" data-rate="0.38">
                  <span class="text-xs font-semibold">BHD</span>
                  <span class="text-xs" style="color:var(--muted)">Bahraini Dinar</span>
                </button>
                <button class="currency-option w-full flex items-center gap-2 px-2 py-2 text-left hover:bg-white/5 transition rounded text-sm" data-currency="EUR" data-symbol="€" data-rate="0.92">
                  <span class="text-xs font-semibold">EUR</span>
                  <span class="text-xs" style="color:var(--muted)">Euro</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        <button id="btnLock" class="icon-btn size-8 rounded-xl border hover:bg-white/5 transition" title="Lock/Unlock all inputs" style="border-color:var(--stroke)">
          <svg id="iconLock" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
            <path d="M12 15v2"/>
            <path d="M8 11V7a4 4 0 0 1 8 0v4"/>
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          </svg>
        </button>
        <button id="btnTheme" class="icon-btn size-8 rounded-xl border hover:bg-white/5 transition" title="Toggle theme" style="border-color:var(--stroke)">
          <svg id="iconTheme" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
            <path d="M12 3v1m0 16v1m9-9h1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        </button>
        
        <!-- Sign In Button (visible when not authenticated) -->
        <button id="btnSignIn" class="nav-btn" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
            <polyline points="10,17 15,12 10,7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
          </svg>
          Sign In
        </button>
        
        <!-- Account Dropdown -->
        <div class="relative">
          <button id="accountMenuBtn" class="icon-btn size-8 rounded-xl border hover:bg-white/5 transition" title="Account" style="border-color:var(--stroke); display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4" style="display: block; margin: 0 auto;">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </button>
          
          <!-- Account Dropdown Menu -->
          <div id="accountDropdown" class="absolute right-0 top-full mt-2 w-56 rounded-lg shadow-lg z-50" style="display: none; background:var(--bg); border: 1px solid var(--stroke);">
            <div class="p-3">
              <!-- Authentication Section -->
              <div id="authSection">
                <!-- Login Button (shown when not authenticated) -->
                <button id="btnLogin" class="w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-white/5 transition rounded text-sm" style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10,17 15,12 10,7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                  </svg>
                  <span>Sign In</span>
                </button>
                
                <!-- User Info (shown when authenticated) -->
                <div id="userInfo" style="display: none;">
                  <div class="flex items-center gap-2 mb-3 pb-3 border-b" style="border-color:var(--stroke);">
                    <img id="userPhoto" src="" alt="User" class="w-8 h-8 rounded-full" style="display: none;">
                    <div class="min-w-0 flex-1">
                      <div id="userName" class="font-medium text-sm truncate"></div>
                      <div id="userEmail" class="text-xs truncate" style="color:var(--muted)"></div>
                    </div>
                  </div>
                  
                  <div class="space-y-1">
                    <button id="accountBtn" class="w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-white/5 transition rounded text-sm">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                      </svg>
                      <span>Account</span>
                    </button>
                    
                    <button id="changePasswordBtn" class="w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-white/5 transition rounded text-sm">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <circle cx="12" cy="16" r="1"></circle>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                      </svg>
                      <span>Change Password</span>
                    </button>
                    
                    <button id="btnSettings" class="w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-white/5 transition rounded text-sm">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                      <span>Settings</span>
                    </button>
                    
                    <button id="btnLogout" class="w-full flex items-center gap-2 px-3 py-2 text-left hover:bg-white/5 transition rounded text-sm text-red-400">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                      </svg>
                      <span>Sign Out</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modern Notification Center -->
        <div id="notificationCenter" class="notification-center" style="opacity:0; transform:translate(-50%, -50%) translateX(20px);">
          <div class="notification-content">
            <div class="notification-text">Data saved successfully</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Bottom Navigation -->
    <div id="mobileBottomNav" class="mobile-bottom-nav">
      <button class="mobile-nav-btn active" data-page="analytics">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="nav-icon">
          <path d="M3 3v18h18"/>
          <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
        </svg>
        <span class="nav-label">Analytics</span>
      </button>
      <button class="mobile-nav-btn" data-page="expenses">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="nav-icon">
          <path d="M12 19V5M5 12l7-7 7 7"/>
        </svg>
        <span class="nav-label">Expenses</span>
      </button>
      <button class="mobile-nav-btn" data-page="income">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="nav-icon">
          <path d="M12 5v14M19 12l-7 7-7-7"/>
        </svg>
        <span class="nav-label">Income</span>
      </button>
    </div>


    <!-- Expenses Page -->
    <div id="pageExpenses" class="page-content" style="display: none;">
      <!-- KPIs -->
      <section id="kpis" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mb-4">
      <div class="kpi kpi-em sm:col-span-1" data-analytics="all">
        <h3 class="tooltip-trigger">All
          <div class="tooltip">Total expenses (Personal + Business)</div>
        </h3>
        <div class="grid grid-cols-2 gap-6 items-end">
          <div class="tooltip-trigger">
            <div class="text-[11px]" style="color:var(--muted)">Monthly</div>
            <div class="value" id="kpiAllMonthlyUSD">$0.00</div>
            <div class="sub" id="kpiAllMonthlyEGP">0</div>
            <div class="tooltip">Total monthly spending across all categories</div>
          </div>
          <div class="text-right tooltip-trigger">
            <div class="text-[11px]" style="color:var(--muted)">Yearly</div>
            <div class="value" id="kpiAllYearlyUSD">$0.00</div>
            <div class="sub" id="kpiAllYearlyEGP">0</div>
            <div class="tooltip tooltip-left">Total yearly spending across all categories</div>
          </div>
        </div>
        <!-- Skeleton Loading -->
        <div class="card-skeleton hidden" id="kpiAllSkeleton">
          <div class="skeleton-text-sm skeleton-w-20"></div>
          <div class="grid grid-cols-2 gap-6 items-end">
            <div>
              <div class="skeleton-text-sm skeleton-w-24"></div>
              <div class="skeleton-text-xl skeleton-w-32"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
            <div class="text-right">
              <div class="skeleton-text-sm skeleton-w-24"></div>
              <div class="skeleton-text-xl skeleton-w-32"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
          </div>
        </div>
        <div class="mt-2 flex items-center justify-between text-xs">
          <span id="kpiFxLabel" style="color:var(--muted)">FX (USD→EGP)</span>
          <span class="font-semibold" id="kpiFxSmall">—</span>
        </div>
        <div class="mt-2 grid grid-cols-2 gap-4 text-xs">
          <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Personal share</span><span id="sharePersonalVal">0%</span></div><div class="bar mt-1 h-2 loading" id="sharePersonalBarContainer"><span id="sharePersonalBar" style="width:0%"></span></div></div>
          <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Biz share</span><span id="shareBizVal">0%</span></div><div class="bar mt-1 h-2 loading" id="shareBizBarContainer"><span id="shareBizBar" style="width:0%"></span></div></div>
        </div>
        
        <!-- Analytics Panel -->
        <div class="kpi-expanded">
          <div class="analytics-header">
            <h4 class="analytics-title">Complete Financial Overview</h4>
            <button class="analytics-close" data-close-analytics>×</button>
      </div>
          <div class="analytics-content" id="analyticsAll"></div>
        </div>
      </div>
      
      <div class="kpi" data-analytics="personal">
        <h3 class="tooltip-trigger">Personal
          <div class="tooltip">Personal lifestyle expenses (food, rent, etc.)</div>
        </h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Monthly</div><div class="value" id="kpiPersonalMonthly">$0.00</div><div class="sub" id="kpiPersonalMonthlyEGP">0</div>
            <div class="tooltip">Monthly personal spending</div>
          </div>
          <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Yearly</div><div class="value" id="kpiPersonalYearly">$0.00</div><div class="sub" id="kpiPersonalYearlyEGP">0</div>
            <div class="tooltip tooltip-left">Yearly personal spending</div>
          </div>
        </div>
        <!-- Skeleton Loading -->
        <div class="card-skeleton hidden" id="kpiPersonalSkeleton">
          <div class="skeleton-text-sm skeleton-w-24"></div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
              <div class="skeleton-text-lg skeleton-w-24"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
            <div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
              <div class="skeleton-text-lg skeleton-w-24"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
          </div>
        </div>
        
        <!-- Analytics Panel -->
        <div class="kpi-expanded">
          <div class="analytics-header">
            <h4 class="analytics-title">Personal Expenses Analytics</h4>
            <button class="analytics-close" data-close-analytics>×</button>
      </div>
          <div class="analytics-content" id="analyticsPersonal"></div>
        </div>
      </div>
      
      <div class="kpi" data-analytics="biz">
        <h3 class="tooltip-trigger">Biz
          <div class="tooltip">Business expenses (tools, software, etc.)</div>
        </h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Monthly</div><div class="value" id="kpiBizMonthly">$0.00</div><div class="sub" id="kpiBizMonthlyEGP">0</div>
            <div class="tooltip">Monthly business spending</div>
          </div>
          <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Yearly</div><div class="value" id="kpiBizYearly">$0.00</div><div class="sub" id="kpiBizYearlyEGP">0</div>
            <div class="tooltip tooltip-left">Yearly business spending</div>
          </div>
        </div>
        <!-- Skeleton Loading -->
        <div class="card-skeleton hidden" id="kpiBizSkeleton">
          <div class="skeleton-text-sm skeleton-w-20"></div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
              <div class="skeleton-text-lg skeleton-w-24"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
            <div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
              <div class="skeleton-text-lg skeleton-w-24"></div>
              <div class="skeleton-text-sm skeleton-w-20"></div>
            </div>
          </div>
        </div>
        
        <!-- Analytics Panel -->
        <div class="kpi-expanded">
          <div class="analytics-header">
            <h4 class="analytics-title">Business Expenses Analytics</h4>
            <button class="analytics-close" data-close-analytics>×</button>
      </div>
          <div class="analytics-content" id="analyticsBiz"></div>
      </div>
      </div>
    </section>


    <!-- Personal table -->
    <section class="p-0 space-y-2">
      <h2 class="text-sm font-medium mb-4 px-1 sticky-header" style="color:var(--fg)">Personal Expenses</h2>
      <div class="table-container">
        <div class="table">
          <div class="row row-head">
            <div></div><div></div><div class="tooltip-trigger">Name<div class="tooltip">Expense name or description</div></div><div class="tooltip-trigger">Cost USD<div class="tooltip">Original cost in US Dollars</div></div><div class="tooltip-trigger">Status<div class="tooltip">Active or Inactive status</div></div><div class="tooltip-trigger">Billing<div class="tooltip">Monthly or Yearly billing cycle</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="monthly" draggable="true">Monthly USD<div class="tooltip">Monthly cost in USD (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="yearly" draggable="true">Yearly USD<div class="tooltip">Yearly cost in USD (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="monthly-egp" draggable="true" id="headerMonthlyEGP">Monthly EGP<div class="tooltip">Monthly cost in EGP (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="yearly-egp" draggable="true" id="headerYearlyEGP">Yearly EGP<div class="tooltip">Yearly cost in EGP (drag to reorder)</div></div><div></div>
          </div>
          <!-- Loading Skeleton -->
          <div id="loading-skeleton" class="loading-skeleton">
            <div class="skeleton-rows">
              <div class="skeleton-row">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
              <div class="skeleton-row">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
              <div class="skeleton-row">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
            </div>
          </div>
          <div id="list-personal"></div>
          <button class="btn w-full justify-start text-xs py-3 mx-0 my-3 tooltip-trigger" data-add-row="personal" style="font-size:.65rem; border:1px dashed var(--stroke); background:var(--glass); color:var(--muted); transition:all .2s ease; border-radius:8px; margin-top:8px;">+ Add a row<div class="tooltip">Add a new personal expense</div></button>
          <div id="sum-personal" class="row row-sum"></div>
        </div>
      </div>
    </section>

    <!-- Biz table -->
    <section class="p-0 space-y-2 mt-8">
      <h2 class="text-sm font-medium mb-4 px-1 sticky-header" style="color:var(--fg)">Biz Expenses</h2>
      <div class="table-container">
        <div class="table">
          <div class="row row-head row-biz">
            <div></div><div></div><div class="tooltip-trigger">Name<div class="tooltip">Business expense name or description</div></div><div class="tooltip-trigger">Cost USD<div class="tooltip">Original cost in US Dollars</div></div><div class="tooltip-trigger">Status<div class="tooltip">Active or Inactive status</div></div><div class="tooltip-trigger">Billing<div class="tooltip">Monthly or Yearly billing cycle</div></div><div class="tooltip-trigger">DATE<div class="tooltip">Next payment due date</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="monthly" draggable="true">Monthly USD<div class="tooltip">Monthly cost in USD (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="yearly" draggable="true">Yearly USD<div class="tooltip">Yearly cost in USD (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="monthly-egp" draggable="true" id="headerBizMonthlyEGP">Monthly EGP<div class="tooltip">Monthly cost in EGP (drag to reorder)</div></div><div class="draggable-header financial-column tooltip-trigger" data-column="yearly-egp" draggable="true" id="headerBizYearlyEGP">Yearly EGP<div class="tooltip">Yearly cost in EGP (drag to reorder)</div></div><div></div>
          </div>
          <!-- Loading Skeleton for Business -->
          <div id="loading-skeleton-biz" class="loading-skeleton">
            <div class="skeleton-rows">
              <div class="skeleton-row skeleton-row-biz">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-next"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
              <div class="skeleton-row skeleton-row-biz">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-next"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
              <div class="skeleton-row skeleton-row-biz">
                <div class="skeleton-cell skeleton-drag"></div>
                <div class="skeleton-cell skeleton-icon"></div>
                <div class="skeleton-cell skeleton-name"></div>
                <div class="skeleton-cell skeleton-cost"></div>
                <div class="skeleton-cell skeleton-status"></div>
                <div class="skeleton-cell skeleton-billing"></div>
                <div class="skeleton-cell skeleton-next"></div>
                <div class="skeleton-cell skeleton-monthly"></div>
                <div class="skeleton-cell skeleton-yearly"></div>
                <div class="skeleton-cell skeleton-monthly-egp"></div>
                <div class="skeleton-cell skeleton-yearly-egp"></div>
                <div class="skeleton-cell skeleton-delete"></div>
              </div>
            </div>
          </div>
          <div id="list-biz"></div>
          <button class="btn w-full justify-start text-xs py-3 mx-0 my-3 tooltip-trigger" data-add-row="biz" style="font-size:.65rem; border:1px dashed var(--stroke); background:var(--glass); color:var(--muted); transition:all .2s ease; border-radius:8px; margin-top:8px;">+ Add a row<div class="tooltip">Add a new business expense</div></button>
          <div id="sum-biz" class="row row-sum row-biz"></div>
        </div>
      </div>
    </section>
    </div>

    <!-- Income Page -->
    <div id="pageIncome" class="page-content" style="display: none;">
      <!-- Income KPIs -->
      <section id="incomeKpis" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mb-4">
        <div class="kpi kpi-em sm:col-span-1" data-analytics="income-all">
          <h3>Lifetime Income</h3>
          <div class="grid grid-cols-2 gap-6 items-end">
            <div class="tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">Per Month</div>
              <div class="value" id="kpiIncomeAllMonthlyUSD">$0.00</div>
              <div class="sub" id="kpiIncomeAllMonthlyEGP">0</div>
              <div class="tooltip">Average monthly earnings across all time</div>
            </div>
            <div class="text-right tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">Per Year</div>
              <div class="value" id="kpiIncomeAllYearlyUSD">$0.00</div>
              <div class="sub" id="kpiIncomeAllYearlyEGP">0</div>
              <div class="tooltip tooltip-left">Average yearly earnings across all time</div>
            </div>
          </div>
          <!-- Skeleton Loading -->
          <div class="card-skeleton hidden" id="kpiIncomeAllSkeleton">
            <div class="skeleton-text-sm skeleton-w-32"></div>
            <div class="grid grid-cols-2 gap-6 items-end">
              <div>
                <div class="skeleton-text-sm skeleton-w-24"></div>
                <div class="skeleton-text-xl skeleton-w-32"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
              <div class="text-right">
                <div class="skeleton-text-sm skeleton-w-24"></div>
                <div class="skeleton-text-xl skeleton-w-32"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs">
            <span id="kpiIncomeFxLabel" style="color:var(--muted)">FX (USD→EGP)</span>
            <span class="font-semibold" id="kpiIncomeFxSmall">â€"</span>
          </div>
          <div class="mt-2 grid grid-cols-2 gap-4 text-xs">
            <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Lifetime Total</span><span id="shareIncomeCompletedVal">$0.00</span></div></div>
            <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Total Entries</span><span id="shareIncomePendingVal">0</span></div></div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Lifetime Income Analytics</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsIncomeAll"></div>
          </div>
        </div>
        
        <div class="kpi" data-analytics="income-monthly">
          <h3>Monthly Income</h3>
          <div class="grid grid-cols-2 gap-6 items-end">
            <div>
              <div class="text-[11px]" style="color:var(--muted)">This Month</div>
              <div class="value" id="kpiIncomeMonthlyCurrent">$0.00</div>
              <div class="sub" id="kpiIncomeMonthlyCurrentEGP">0</div>
            </div>
            <div class="text-right">
              <div class="text-[11px]" style="color:var(--muted)">Average</div>
              <div class="value" id="kpiIncomeMonthlyAvg">$0.00</div>
              <div class="sub" id="kpiIncomeMonthlyAvgEGP">0</div>
            </div>
          </div>
          <!-- Skeleton Loading -->
          <div class="card-skeleton hidden" id="kpiIncomeMonthlySkeleton">
            <div class="skeleton-text-sm skeleton-w-32"></div>
            <div class="grid grid-cols-2 gap-6 items-end">
              <div>
                <div class="skeleton-text-sm skeleton-w-24"></div>
                <div class="skeleton-text-lg skeleton-w-24"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
              <div class="text-right">
                <div class="skeleton-text-sm skeleton-w-20"></div>
                <div class="skeleton-text-lg skeleton-w-24"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
            </div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Monthly Income Analytics</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsIncomeMonthly"></div>
          </div>
        </div>
        
        <div class="kpi" data-analytics="income-yearly">
          <h3>Yearly Income</h3>
          <div class="grid grid-cols-2 gap-6 items-end">
            <div class="tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">This Year</div>
              <div class="value" id="kpiIncomeYearlyCurrent">$0.00</div>
              <div class="sub" id="kpiIncomeYearlyCurrentEGP">0</div>
              <div class="tooltip">Total money earned this year</div>
            </div>
            <div class="text-right tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">Target</div>
              <div class="value" id="kpiIncomeYearlyTarget">$0.00</div>
              <div class="sub" id="kpiIncomeYearlyTargetEGP">0</div>
              <div class="tooltip tooltip-left">Goal: 20% more than your average yearly income</div>
            </div>
          </div>
          <!-- Skeleton Loading -->
          <div class="card-skeleton hidden" id="kpiIncomeYearlySkeleton">
            <div class="skeleton-text-sm skeleton-w-28"></div>
            <div class="grid grid-cols-2 gap-6 items-end">
              <div>
                <div class="skeleton-text-sm skeleton-w-24"></div>
                <div class="skeleton-text-lg skeleton-w-24"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
              <div class="text-right">
                <div class="skeleton-text-sm skeleton-w-20"></div>
                <div class="skeleton-text-lg skeleton-w-24"></div>
                <div class="skeleton-text-sm skeleton-w-20"></div>
              </div>
            </div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Yearly Income Analytics</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsIncomeYearly"></div>
          </div>
        </div>
      </section>

      <!-- Income Table -->
      <section class="p-0 space-y-2">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-sm font-medium px-1 sticky-header" style="color:var(--fg)">Income</h2>
          <!-- Year Tabs (only visible on Income page) -->
          <div id="yearTabsContainer" class="flex items-center gap-1">
            <!-- Year tabs will be dynamically generated here -->
            <button id="manageYearsBtn" class="year-tab-manage" title="Manage Years">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="table-container">
          <div class="table">
            <div class="row row-head row-income">
              <div></div><div></div><div class="tooltip-trigger">Project Name<div class="tooltip">Name of the project or client</div></div><div class="tooltip-trigger">Tags<div class="tooltip">Project categories or tags</div></div><div class="tooltip-trigger">Date<div class="tooltip">Payment received date</div></div><div class="tooltip-trigger">All Payment<div class="tooltip">Total project payment amount</div></div><div class="tooltip-trigger">Paid USD<div class="tooltip">Amount paid in US Dollars</div></div><div class="tooltip-trigger" id="headerPaidEGP">Paid EGP<div class="tooltip">Amount paid in EGP</div></div><div class="tooltip-trigger">Method<div class="tooltip">Payment method (bank, cash, etc.)</div></div><div></div>
            </div>
            <div id="list-income"></div>
            <button class="btn w-full justify-start text-xs py-3 mx-0 my-3 tooltip-trigger" data-add-row="income" style="font-size:.65rem; border:1px dashed var(--stroke); background:var(--glass); color:var(--muted); transition:all .2s ease; border-radius:8px; margin-top:8px;">+ Add a row<div class="tooltip">Add a new income entry</div></button>
            <div id="sum-income" class="row row-sum row-income"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Analytics Page -->
    <div id="pageAnalytics" class="page-content">
      <!-- Analytics KPIs -->
      <section id="analyticsKpis" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4 mb-4">
        <!-- Net Cash Flow Card -->
        <div class="kpi kpi-em sm:col-span-1" data-analytics="cashflow">
          <h3 class="tooltip-trigger">Net Cash Flow
            <div class="tooltip">Income minus expenses (positive = saving money)</div>
          </h3>
          <div class="grid grid-cols-2 gap-6 items-end">
            <div class="tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">Monthly</div>
              <div class="value" id="analyticsCashFlowMonthlyUSD">$0.00</div>
              <div class="sub" id="analyticsCashFlowMonthlyEGP">0</div>
              <div class="tooltip">Monthly income minus monthly expenses</div>
            </div>
            <div class="text-right tooltip-trigger">
              <div class="text-[11px]" style="color:var(--muted)">Yearly</div>
              <div class="value" id="analyticsCashFlowYearlyUSD">$0.00</div>
              <div class="sub" id="analyticsCashFlowYearlyEGP">0</div>
              <div class="tooltip tooltip-left">Yearly income minus yearly expenses</div>
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs">
            <span style="color:var(--muted)">Status</span>
            <span class="font-semibold" id="analyticsCashFlowStatus">—</span>
          </div>
          <div class="mt-2 grid grid-cols-2 gap-4 text-xs">
            <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Income</span><span id="analyticsIncomeVal">$0.00</span></div><div class="bar mt-1 h-2 loading" id="analyticsIncomeBarContainer"><span id="analyticsIncomeBar" style="width:0%"></span></div></div>
            <div><div class="flex items-center justify-between"><span style="color:var(--muted)">Expenses</span><span id="analyticsExpensesVal">$0.00</span></div><div class="bar mt-1 h-2 loading" id="analyticsExpensesBarContainer"><span id="analyticsExpensesBar" style="width:0%"></span></div></div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Cash Flow Analysis</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsCashFlow"></div>
          </div>
        </div>
        
        <!-- Savings Rate Card -->
        <div class="kpi" data-analytics="savings">
          <h3 class="tooltip-trigger">Savings Rate
            <div class="tooltip">Percentage of income saved after expenses</div>
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Monthly</div><div class="value" id="analyticsSavingsRateMonthly">0%</div><div class="sub" id="analyticsSavingsRateMonthlyStatus">Status</div>
              <div class="tooltip">Monthly savings as % of monthly income</div>
            </div>
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Yearly</div><div class="value" id="analyticsSavingsRateYearly">0%</div><div class="sub" id="analyticsSavingsRateYearlyStatus">Status</div>
              <div class="tooltip tooltip-left">Yearly savings as % of yearly income</div>
            </div>
          </div>
          <div class="mt-2 text-xs">
            <div class="flex items-center justify-between tooltip-trigger"><span style="color:var(--muted)">Target: 20%</span><span id="analyticsSavingsTarget">0%</span>
              <div class="tooltip">Recommended savings rate for financial health</div>
            </div>
            <div class="bar mt-1 h-2 loading" id="analyticsSavingsProgressBarContainer"><span id="analyticsSavingsProgressBar" style="width:0%"></span></div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Savings Analysis</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsSavings"></div>
          </div>
        </div>
        
        <!-- Expense Efficiency Card -->
        <div class="kpi" data-analytics="efficiency">
          <h3 class="tooltip-trigger">Expense Efficiency
            <div class="tooltip">How much of your income goes to expenses</div>
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Personal</div><div class="value" id="analyticsPersonalEfficiency">0%</div><div class="sub" id="analyticsPersonalEfficiencyStatus">of Income</div>
              <div class="tooltip">Personal expenses as % of total income</div>
            </div>
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Business</div><div class="value" id="analyticsBusinessEfficiency">0%</div><div class="sub" id="analyticsBusinessEfficiencyStatus">of Income</div>
              <div class="tooltip tooltip-left">Business expenses as % of total income</div>
            </div>
          </div>
          <div class="mt-2 text-xs">
            <div class="flex items-center justify-between"><span style="color:var(--muted)">Total Efficiency</span><span id="analyticsTotalEfficiency">0%</span></div>
            <div class="bar mt-1 h-2 loading" id="analyticsEfficiencyBarContainer"><span id="analyticsEfficiencyBar" style="width:0%"></span></div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Efficiency Analysis</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsEfficiency"></div>
          </div>
        </div>

        <!-- Financial Health Score Card -->
        <div class="kpi" data-analytics="health">
          <h3 class="tooltip-trigger">Financial Health
            <div class="tooltip">Overall financial wellness score (0-100)</div>
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Score</div><div class="value" id="analyticsHealthScore">0</div><div class="sub" id="analyticsHealthScoreStatus">/100</div>
              <div class="tooltip">Health score based on savings, cash flow, and efficiency</div>
            </div>
            <div class="tooltip-trigger"><div class="text-[11px]" style="color:var(--muted)">Grade</div><div class="value" id="analyticsHealthGrade">F</div><div class="sub" id="analyticsHealthGradeStatus">Grade</div>
              <div class="tooltip tooltip-left">Letter grade (A+ to F) for your financial health</div>
            </div>
          </div>
          <div class="mt-2 text-xs">
            <div class="flex items-center justify-between"><span style="color:var(--muted)">Progress</span><span id="analyticsHealthProgress">0%</span></div>
            <div class="bar mt-1 h-2 loading" id="analyticsHealthBarContainer"><span id="analyticsHealthBar" style="width:0%"></span></div>
          </div>
          
          <!-- Analytics Panel -->
          <div class="kpi-expanded">
            <div class="analytics-header">
              <h4 class="analytics-title">Health Analysis</h4>
              <button class="analytics-close" data-close-analytics>×</button>
            </div>
            <div class="analytics-content" id="analyticsHealth"></div>
          </div>
        </div>
      </section>

      <!-- Income Flow Chart Section -->
      <section class="mb-6">
        <div class="card p-6" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold px-1 tooltip-trigger" style="color:var(--fg)">
              Income Flow Over Time
              <div class="tooltip">Visual representation of your income trends across time periods</div>
            </h2>
            <div class="flex items-center gap-2 text-xs tooltip-trigger" style="color:var(--muted)">
              <span id="chartCurrencyDisplay">EGP</span>
              <div class="w-2 h-2 rounded-full" style="background:linear-gradient(90deg, rgba(99,102,241,.9), rgba(56,189,248,.9))"></div>
              <div class="tooltip tooltip-left">Chart displays values in selected currency</div>
            </div>
          </div>
          <div class="relative">
            <canvas id="incomeFlowChart" width="400" height="200"></canvas>
            <div id="chartLoading" class="absolute inset-0 flex items-center justify-center" style="background:var(--card); border-radius:0.5rem;">
              <div class="text-sm" style="color:var(--muted)">Loading chart data...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Income Heatmap Section -->
      <section class="mb-6">
        <div class="card p-6" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold px-1 tooltip-trigger" style="color:var(--fg)">
              Income Calendar Heatmap
              <div class="tooltip">Visual calendar showing daily income patterns throughout the year</div>
            </h2>
            <div class="flex items-center gap-3">
              <!-- Year Filter -->
              <div class="flex items-center gap-2">
                <label class="text-xs" style="color:var(--muted)">Year:</label>
                <select id="heatmapYearSelect" class="heatmap-year-select">
                  <!-- Years will be populated dynamically -->
                </select>
              </div>
              <!-- Refresh Heatmap -->
              <button id="heatmapRefreshBtn" class="tooltip-trigger" style="width:18px; height:18px; display:grid; place-items:center; border:1px solid var(--stroke); border-radius:4px; background:var(--glass)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:10px; height:10px; color:var(--muted)">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                  <path d="M21 3v5h-5"/>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                  <path d="M3 21v-5h5"/>
                </svg>
                <div class="tooltip">Refresh heatmap</div>
              </button>
              <div class="flex items-center gap-2 text-xs tooltip-trigger" style="color:var(--muted)">
                <span id="heatmapCurrencyDisplay">EGP</span>
                <div class="w-2 h-2 rounded-full" style="background:linear-gradient(90deg, rgba(99,102,241,.9), rgba(56,189,248,.9))"></div>
                <div class="tooltip tooltip-left">Heatmap displays values in selected currency</div>
              </div>
            </div>
          </div>
          
          <!-- Heatmap Legend removed for cleaner UI in light mode -->
          
          <!-- Calendar Heatmap Container -->
          <div class="heatmap-container">
            <div id="heatmapCalendar" class="heatmap-calendar">
              <!-- Calendar will be generated dynamically -->
            </div>
          </div>
          
          <!-- Heatmap Stats -->
          <div class="heatmap-stats grid grid-cols-2 text-xs">
            <div class="flex items-center justify-between">
              <span style="color:var(--muted)">Highest Day</span>
              <span id="heatmapHighestDay" class="font-semibold">$0.00</span>
            </div>
            <div class="flex items-center justify-between">
              <span style="color:var(--muted)">Average/Day</span>
              <span id="heatmapAverageDay" class="font-semibold">$0.00</span>
            </div>
          </div>
        </div>
      </section>

          <!-- Insight Cards Section -->
          <section class="space-y-6">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold px-1" style="color:var(--fg)">Smart Insights</h2>
              <button onclick="updateInsightCards()" class="text-xs px-2 py-1 rounded" style="background:var(--accent); color:var(--bg)">Refresh</button>
            </div>
        
        <div class="grid gap-4 sm:grid-cols-2">
          <!-- Personal Insights Card -->
          <div class="card p-4" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
            <div class="insight-card-header mb-3">
              <h3 class="text-sm font-semibold" style="color:var(--fg)">🏠 Lifestyle Insights</h3>
            </div>
            <div class="insight-card-content" id="personalInsightsCard">
              <div class="insight-line">Loading insights...</div>
            </div>
          </div>

          <!-- Business Insights Card -->
          <div class="card p-4" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
            <div class="insight-card-header mb-3">
              <h3 class="text-sm font-semibold" style="color:var(--fg)">💼 Business Insights</h3>
            </div>
            <div class="insight-card-content" id="bizInsightsCard">
              <div class="insight-line">Loading insights...</div>
            </div>
          </div>

          <!-- Income Insights Card -->
          <div class="card p-4" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
            <div class="insight-card-header mb-3">
              <h3 class="text-sm font-semibold" style="color:var(--fg)">💰 Income Insights</h3>
            </div>
            <div class="insight-card-content" id="incomeInsightsCard">
              <div class="insight-line">Loading insights...</div>
            </div>
          </div>

          <!-- Overall Financial Health Card -->
          <div class="card p-4" style="background:var(--card); border:1px solid var(--stroke); border-radius:1rem;">
            <div class="insight-card-header mb-3">
              <h3 class="text-sm font-semibold" style="color:var(--fg)">📊 Financial Health</h3>
            </div>
            <div class="insight-card-content" id="overallInsightsCard">
              <div class="insight-line">Loading insights...</div>
            </div>
          </div>
        </div>
      </section>
    </div>

  <!-- Settings Modal -->
  <dialog id="settings" class="backdrop:bg-black/60 rounded-2xl w-full max-w-xl p-0 settings-modal">
    <form method="dialog" class="card p-5 space-y-4 settings-modal-content">
      <header class="flex items-start justify-between">
        <div>
          <h3 class="text-lg font-semibold">Settings</h3>
          <p class="text-xs" style="color:var(--muted)">FX override. Saved locally.</p>
        </div>
        <button class="btn btn-ghost" value="cancel">Close</button>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label id="fxRateLabel" class="text-xs" style="color:var(--muted)">USD → <span id="settingsCurrencyDisplay">EGP</span> Rate</label>
          <div class="flex gap-2 items-center">
            <div class="settings-input-wrapper flex-1">
              <span class="settings-symbol">$</span>
              <input id="inputFx" type="number" step="0.0001" placeholder="48.17" />
            </div>
            <div class="relative">
              <select id="settingsCurrencySelect" class="settings-currency-select" style="padding:.35rem .5rem; font-size:.7rem; border:1px solid var(--stroke); border-radius:6px; background:var(--card); color:var(--fg); min-width:60px;">
                <option value="EGP">EGP</option>
                <option value="KWD">KWD</option>
                <option value="SAR">SAR</option>
                <option value="AED">AED</option>
                <option value="QAR">QAR</option>
                <option value="BHD">BHD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>
            <button id="btnRefreshFx" class="btn btn-ghost" style="padding:.35rem .5rem; font-size:.7rem;" title="Refresh from live rate">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                <path d="M3 21v-5h5"/>
              </svg>
            </button>
          </div>
        </div>
        <div>
          <label class="text-xs" style="color:var(--muted)">Include Annual in Monthly</label>
          <p class="text-xs" style="color:var(--muted); font-size: 0.6rem; margin: 0.25rem 0 0.5rem 0; opacity: 0.7;">Include annual expenses in monthly calculations</p>
          <select id="inputIncludeAnnual" class="select">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>
        </div>
      </div>
      
      <!-- Data Management Section -->
      <div class="border-t pt-4" style="border-color:var(--stroke)">
        <h4 class="text-sm font-medium mb-3" style="color:var(--fg)">Data Management</h4>
        <div class="space-y-3">
          <div class="flex gap-2">
            <button id="btnExportData" class="btn btn-ghost" style="padding:.35rem .5rem; font-size:.7rem;">Export Data</button>
            <button id="btnImportData" class="btn btn-ghost" style="padding:.35rem .5rem; font-size:.7rem;">Import Data</button>
          </div>
          <input id="fileInput" type="file" accept=".json" style="display:none;" />
        </div>
      </div>
      
      <!-- Delete All Data Section -->
      <div class="border-t pt-4" style="border-color:var(--stroke)">
        <h4 class="text-sm font-medium mb-3" style="color:var(--fg)">Danger Zone</h4>
        <div class="space-y-3">
          <div>
            <label class="text-xs" style="color:var(--muted)">Delete All Data</label>
            <p class="text-xs mb-3" style="color:var(--muted)">This will permanently delete all expenses and settings. Type "DELETE" to confirm.</p>
            <div class="space-y-2">
              <input id="inputDeleteConfirm" type="text" class="input w-full" placeholder="Type DELETE to confirm" />
              <button id="btnDeleteAll" class="btn w-full" style="background:#ef4444; color:white; border-color:#ef4444; padding:.5rem 1rem; font-size:.75rem;" disabled>Delete All Data</button>
            </div>
          </div>
        </div>
      </div>
      
    </form>
  </dialog>


  <!-- Icon Picker Modal -->
  <dialog id="iconPicker" class="backdrop:bg-black/60 rounded-2xl w-full max-w-3xl p-0">
    <form method="dialog" class="card p-6 space-y-4" style="background:var(--card); border:1px solid var(--stroke);">
      <header class="flex items-center justify-between">
        <h3 class="text-xl font-semibold">Choose Icon</h3>
        <button class="btn btn-ghost" value="cancel">×</button>
      </header>
      
      <div class="space-y-3">
        <input id="iconSearch" class="input w-full" type="text" placeholder="Search Font Awesome icons..." />
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <!-- Glyph Input -->
        <div class="flex gap-2 items-center">
            <input id="glyphInput" class="input flex-1" type="text" placeholder="Unicode (e.g. e65c)" />
            <div id="glyphPreview" class="size-8 rounded grid place-items-center border" style="background:var(--card); color:var(--fg); border-color:var(--stroke);"></div>
          <button type="button" class="btn btn-primary" id="applyGlyph" style="padding:.4rem .6rem; font-size:.75rem;">Apply</button>
          </div>
          
          <!-- Custom Image Upload -->
          <div class="flex gap-2 items-center">
            <input id="customImageInput" type="file" accept=".svg,.png,.jpg,.jpeg" style="display:none;" />
            <button type="button" class="btn btn-ghost" id="uploadCustomImage" style="padding:.4rem .6rem; font-size:.75rem;">Upload Image</button>
            <div id="imagePreview" class="size-8 rounded grid place-items-center border" style="background:var(--card); color:var(--fg); border-color:var(--stroke);"></div>
            <button type="button" class="btn btn-primary" id="applyCustomImage" style="padding:.4rem .6rem; font-size:.75rem;" disabled>Apply</button>
          </div>
        </div>
      </div>
      
      <div id="iconTabs" class="flex gap-2 border-b pb-2" style="border-color:var(--stroke)">
        <button type="button" class="tab-btn active" data-tab="personal">Personal</button>
        <button type="button" class="tab-btn" data-tab="business">Business</button>
        <button type="button" class="tab-btn" data-tab="brands">Brands</button>
        <button type="button" class="tab-btn" data-tab="custom">Custom</button>
        <button type="button" class="tab-btn" data-tab="all">All</button>
      </div>
      
      <div id="iconPickerGrid" class="grid grid-cols-12 gap-3 max-h-[300px] overflow-auto p-4" style="background:var(--glass); border-radius:.75rem; border:1px solid var(--stroke); scrollbar-width: thin; scrollbar-color: var(--muted) var(--glass);"></div>
      
      <div class="text-xs text-center space-y-2" style="color:var(--muted)">
        <span id="iconCount">Loading icons...</span>
        <div class="flex items-center justify-center gap-2 pt-2 border-t" style="border-color:var(--stroke)">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-3 h-3">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/>
          </svg>
          <a href="https://fontawesome.com/icons" target="_blank" class="text-xs hover:text-blue-400 transition-colors" style="color:var(--muted)">
            Browse more icons at FontAwesome
          </a>
        </div>
      </div>
    </form>
  </dialog>

  <!-- Authentication Modal -->
  <div id="authModal" class="auth-modal" style="display: none;">
    <div class="auth-modal-overlay"></div>
    <div class="auth-modal-content">
      <div class="auth-modal-header">
        <div class="auth-modal-brand">
          <h2 id="authModalTitle" class="auth-modal-title">Welcome to Financial Tool</h2>
        </div>
        <p id="authModalSubtitle" class="auth-modal-subtitle">Sign in to sync your data across devices</p>
        <button class="auth-modal-close" onclick="closeAuthModal()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="auth-modal-body">
        <!-- Email/Password Form -->
        <div id="emailAuthForm" class="auth-form">
          <div class="auth-form-group">
            <label for="authEmail" class="auth-label">Email</label>
            <input type="email" id="authEmail" class="auth-input" placeholder="Enter your email" required>
          </div>
          
          <div class="auth-form-group">
            <label for="authPassword" class="auth-label">Password</label>
            <input type="password" id="authPassword" class="auth-input" placeholder="Enter your password" required>
          </div>
          
          <div class="auth-form-actions">
            <button id="emailSignInBtn" class="auth-btn auth-btn-primary">Sign In</button>
            <button id="emailSignUpBtn" class="auth-btn auth-btn-secondary">Create Account</button>
          </div>
          
          <!-- Forgot Password Link -->
          <div class="auth-forgot-password">
            <button id="forgotPasswordBtn" class="auth-forgot-link">Forgot your password?</button>
          </div>
        </div>
        
        <!-- Forgot Password Form (Hidden by default) -->
        <div id="forgotPasswordForm" class="auth-form" style="display: none;">
          <div class="auth-form-group">
            <label for="forgotEmail" class="auth-label">Email</label>
            <input type="email" id="forgotEmail" class="auth-input" placeholder="Enter your email address" required>
          </div>
          
          <div class="auth-form-actions">
            <button id="sendResetBtn" class="auth-btn auth-btn-primary">Send Reset Link</button>
            <button id="backToSignInBtn" class="auth-btn auth-btn-secondary">Back to Sign In</button>
          </div>
        </div>
        
        <!-- Password Reset Form (Hidden by default) -->
        <div id="passwordResetForm" class="auth-form" style="display: none;">
          <div class="auth-form-group">
            <label for="newPassword" class="auth-label">New Password</label>
            <input type="password" id="newPassword" class="auth-input" placeholder="Enter your new password" required minlength="6">
          </div>
          
          <div class="auth-form-group">
            <label for="confirmPassword" class="auth-label">Confirm New Password</label>
            <input type="password" id="confirmPassword" class="auth-input" placeholder="Confirm your new password" required minlength="6">
          </div>
          
          <div class="auth-form-actions">
            <button id="updatePasswordBtn" class="auth-btn auth-btn-primary">Set New Password</button>
            <button id="cancelResetBtn" class="auth-btn auth-btn-secondary">Cancel</button>
          </div>
        </div>
        
        <!-- Change Password Form (Hidden by default) -->
        <div id="changePasswordForm" class="auth-form" style="display: none;">
          <div class="auth-form-group">
            <label for="changeNewPassword" class="auth-label">New Password</label>
            <input type="password" id="changeNewPassword" class="auth-input" placeholder="Enter your new password" required minlength="6">
          </div>
          
          <div class="auth-form-group">
            <label for="changeConfirmPassword" class="auth-label">Confirm New Password</label>
            <input type="password" id="changeConfirmPassword" class="auth-input" placeholder="Confirm your new password" required minlength="6">
          </div>
          
          <div class="auth-form-actions">
            <button id="savePasswordBtn" class="auth-btn auth-btn-primary">Change Password</button>
            <button id="cancelChangeBtn" class="auth-btn auth-btn-secondary">Cancel</button>
          </div>
        </div>
        
        <!-- Account Management Form (Hidden by default) -->
        <div id="accountForm" class="auth-form" style="display: none;">
          <div class="auth-form-group">
            <label for="accountName" class="auth-label">Full Name</label>
            <input type="text" id="accountName" class="auth-input" placeholder="Enter your full name" required>
          </div>
          
          <div class="auth-form-group">
            <label for="accountEmail" class="auth-label">Email</label>
            <input type="email" id="accountEmail" class="auth-input" placeholder="Enter your email" required readonly>
          </div>
          
          
          <div class="auth-form-group">
            <label for="accountProfilePic" class="auth-label">Profile Picture</label>
            <div class="profile-pic-upload">
              <div class="profile-pic-preview" id="profilePicPreview">
                <div class="profile-pic-placeholder">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
              </div>
              <input type="file" id="accountProfilePic" class="profile-pic-input" accept="image/*" style="display: none;">
              <button type="button" id="uploadProfilePicBtn" class="profile-pic-upload-btn">Choose Photo</button>
            </div>
          </div>
          
          <div class="auth-form-actions">
            <button id="saveAccountBtn" class="auth-btn auth-btn-primary">Save Changes</button>
            <button id="cancelAccountBtn" class="auth-btn auth-btn-secondary">Cancel</button>
          </div>
        </div>
        
        <!-- Auth Status Messages -->
        <div id="authStatus" class="auth-status" style="display: none;"></div>
        
        <!-- Loading State -->
        <div id="authLoading" class="auth-loading" style="display: none;">
          <div class="auth-spinner"></div>
          <span>Signing in...</span>
        </div>
      </div>
      
      <div class="auth-modal-footer">
        <p class="auth-footer-text">
          By signing in, you agree to sync your financial data securely across devices.
        </p>
      </div>
    </div>
    
  </div>
  
  <!-- Custom Date Picker Modal -->
  <div id="customDatePicker" class="custom-date-picker-modal" style="display: none;">
    <div class="custom-date-picker">
      <div class="date-picker-header">
        <button class="date-picker-nav" id="prevMonth">‹</button>
        <div class="date-picker-month-year">
          <select id="monthSelect"></select>
          <select id="yearSelect"></select>
        </div>
        <button class="date-picker-nav" id="nextMonth">›</button>
      </div>
      <div class="date-picker-weekdays">
        <div class="weekday">Sun</div>
        <div class="weekday">Mon</div>
        <div class="weekday">Tue</div>
        <div class="weekday">Wed</div>
        <div class="weekday">Thu</div>
        <div class="weekday">Fri</div>
        <div class="weekday">Sat</div>
      </div>
      <div class="date-picker-days" id="datePickerDays"></div>
      <div class="date-picker-footer">
        <button class="date-picker-btn" id="clearDate">Clear</button>
        <button class="date-picker-btn primary" id="todayDate">Today</button>
      </div>
    </div>
  </div>

</body>


</html>
